{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid.core.virtual_data_loader.js)\r\n * Version: 22.2.6\r\n * Build date: Tue Apr 18 2023\r\n *\r\n * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { Deferred, when } from \"../../core/utils/deferred\";\nimport { isObject, isString } from \"../../core/utils/type\";\nvar LEGACY_SCROLLING_MODE = \"scrolling.legacyMode\";\nvar needTwoPagesLoading = that => that.option(\"scrolling.loadTwoPagesOnStart\") || that._controller.isVirtual() || that._controller.getViewportItemIndex() > 0;\nvar getBeginPageIndex = that => that._cache.length ? that._cache[0].pageIndex : -1;\nvar getEndPageIndex = that => that._cache.length ? that._cache[that._cache.length - 1].pageIndex : -1;\nvar fireChanged = (that, changed, args) => {\n  that._isChangedFiring = true;\n  changed(args);\n  that._isChangedFiring = false;\n};\nvar processDelayChanged = (that, changed, args) => {\n  if (that._isDelayChanged) {\n    that._isDelayChanged = false;\n    fireChanged(that, changed, args);\n    return true;\n  }\n};\nvar getViewportPageCount = that => {\n  var pageSize = that._dataOptions.pageSize();\n  var preventPreload = that.option(\"scrolling.preventPreload\");\n  if (preventPreload) {\n    return 0;\n  }\n  var realViewportSize = that._controller.viewportSize();\n  if (that._controller.isVirtualMode() && that.option(\"scrolling.removeInvisiblePages\")) {\n    realViewportSize = 0;\n    var viewportSize = that._controller.viewportSize() * that._controller.viewportItemSize();\n    var offset = that._controller.getContentOffset();\n    var position = that._controller.getViewportPosition();\n    var virtualItemsCount = that._controller.virtualItemsCount();\n    var totalItemsCount = that._dataOptions.totalItemsCount();\n    for (var itemIndex = virtualItemsCount.begin; itemIndex < totalItemsCount; itemIndex++) {\n      if (offset >= position + viewportSize) {\n        break;\n      }\n      var itemSize = that._controller.getItemSizes()[itemIndex] || that._controller.viewportItemSize();\n      offset += itemSize;\n      if (offset >= position) {\n        realViewportSize++;\n      }\n    }\n  }\n  return pageSize && realViewportSize > 0 ? Math.ceil(realViewportSize / pageSize) : 1;\n};\nvar getPreloadPageCount = (that, previous) => {\n  var preloadEnabled = that.option(\"scrolling.preloadEnabled\");\n  var pageCount = getViewportPageCount(that);\n  var isAppendMode = that._controller.isAppendMode();\n  if (pageCount) {\n    if (previous) {\n      pageCount = preloadEnabled ? 1 : 0;\n    } else {\n      if (preloadEnabled) {\n        pageCount++;\n      }\n      if (isAppendMode || !needTwoPagesLoading(that)) {\n        pageCount--;\n      }\n    }\n  }\n  return pageCount;\n};\nvar getPageIndexForLoad = that => {\n  var result = -1;\n  var beginPageIndex = getBeginPageIndex(that);\n  var dataOptions = that._dataOptions;\n  if (beginPageIndex < 0) {\n    result = that._pageIndex;\n  } else if (!that._cache[that._pageIndex - beginPageIndex]) {\n    result = that._pageIndex;\n  } else if (beginPageIndex >= 0 && that._controller.viewportSize() >= 0) {\n    if (beginPageIndex > 0) {\n      var needToLoadPageBeforeLast = getEndPageIndex(that) + 1 === dataOptions.pageCount() && that._cache.length < getPreloadPageCount(that) + 1;\n      var needToLoadPrevPage = needToLoadPageBeforeLast || that._pageIndex === beginPageIndex && getPreloadPageCount(that, true);\n      if (needToLoadPrevPage) {\n        result = beginPageIndex - 1;\n      }\n    }\n    if (result < 0) {\n      var needToLoadNextPage = beginPageIndex + that._cache.length <= that._pageIndex + getPreloadPageCount(that);\n      if (needToLoadNextPage) {\n        result = beginPageIndex + that._cache.length;\n      }\n    }\n  }\n  if (that._loadingPageIndexes[result]) {\n    result = -1;\n  }\n  return result;\n};\nvar loadCore = (that, pageIndex) => {\n  var dataOptions = that._dataOptions;\n  if (pageIndex === that.pageIndex() || !dataOptions.isLoading() && pageIndex < dataOptions.pageCount() || !dataOptions.hasKnownLastPage() && pageIndex === dataOptions.pageCount()) {\n    dataOptions.pageIndex(pageIndex);\n    that._loadingPageIndexes[pageIndex] = true;\n    return when(dataOptions.load()).always(() => {\n      that._loadingPageIndexes[pageIndex] = false;\n    });\n  }\n};\nvar processChanged = (that, changed, changeType, isDelayChanged, removeCacheItem) => {\n  var dataOptions = that._dataOptions;\n  var items = dataOptions.items().slice();\n  var change = isObject(changeType) ? changeType : void 0;\n  var isPrepend = \"prepend\" === changeType;\n  var viewportItems = dataOptions.viewportItems();\n  if (changeType && isString(changeType) && !that._isDelayChanged) {\n    change = {\n      changeType: changeType,\n      items: items\n    };\n    if (removeCacheItem) {\n      change.removeCount = removeCacheItem.itemsCount;\n      if (change.removeCount && dataOptions.correctCount) {\n        change.removeCount = dataOptions.correctCount(viewportItems, change.removeCount, isPrepend);\n      }\n    }\n  }\n  var removeItemCount = removeCacheItem ? removeCacheItem.itemsLength : 0;\n  if (removeItemCount && dataOptions.correctCount) {\n    removeItemCount = dataOptions.correctCount(viewportItems, removeItemCount, isPrepend);\n  }\n  if (\"append\" === changeType) {\n    viewportItems.push.apply(viewportItems, items);\n    if (removeCacheItem) {\n      viewportItems.splice(0, removeItemCount);\n    }\n  } else if (isPrepend) {\n    viewportItems.unshift.apply(viewportItems, items);\n    if (removeCacheItem) {\n      viewportItems.splice(-removeItemCount);\n    }\n  } else {\n    that._dataOptions.viewportItems(items);\n  }\n  dataOptions.updateLoading();\n  that._lastPageIndex = that.pageIndex();\n  that._isDelayChanged = isDelayChanged;\n  if (!isDelayChanged) {\n    fireChanged(that, changed, change);\n  }\n};\nexport class VirtualDataLoader {\n  constructor(controller, dataOptions) {\n    this._controller = controller;\n    this._dataOptions = dataOptions;\n    this._pageIndex = this._lastPageIndex = dataOptions.pageIndex();\n    this._cache = [];\n    this._loadingPageIndexes = {};\n  }\n  option() {\n    return this._controller.option.apply(this._controller, arguments);\n  }\n  viewportItemIndexChanged(itemIndex) {\n    var pageSize = this._dataOptions.pageSize();\n    var pageCount = this._dataOptions.pageCount();\n    var virtualMode = this._controller.isVirtualMode();\n    var appendMode = this._controller.isAppendMode();\n    var totalItemsCount = this._dataOptions.totalItemsCount();\n    var newPageIndex;\n    if (pageSize && (virtualMode || appendMode) && totalItemsCount >= 0) {\n      var viewportSize = this._controller.viewportSize();\n      if (viewportSize && itemIndex + viewportSize >= totalItemsCount && !this._controller.isVirtual()) {\n        if (this._dataOptions.hasKnownLastPage()) {\n          newPageIndex = pageCount - 1;\n          var lastPageSize = totalItemsCount % pageSize;\n          if (newPageIndex > 0 && lastPageSize > 0 && lastPageSize < viewportSize) {\n            newPageIndex--;\n          }\n        } else {\n          newPageIndex = pageCount;\n        }\n      } else {\n        newPageIndex = Math.floor(itemIndex / pageSize);\n        var maxPageIndex = pageCount - 1;\n        newPageIndex = Math.max(newPageIndex, 0);\n        newPageIndex = Math.min(newPageIndex, maxPageIndex);\n      }\n      this.pageIndex(newPageIndex);\n      return this.load();\n    }\n  }\n  pageIndex(pageIndex) {\n    var isVirtualMode = this._controller.isVirtualMode();\n    var isAppendMode = this._controller.isAppendMode();\n    if (false !== this.option(LEGACY_SCROLLING_MODE) && (isVirtualMode || isAppendMode)) {\n      if (void 0 !== pageIndex) {\n        this._pageIndex = pageIndex;\n      }\n      return this._pageIndex;\n    } else {\n      return this._dataOptions.pageIndex(pageIndex);\n    }\n  }\n  beginPageIndex(defaultPageIndex) {\n    var beginPageIndex = getBeginPageIndex(this);\n    if (beginPageIndex < 0) {\n      beginPageIndex = void 0 !== defaultPageIndex ? defaultPageIndex : this.pageIndex();\n    }\n    return beginPageIndex;\n  }\n  endPageIndex() {\n    var endPageIndex = getEndPageIndex(this);\n    return endPageIndex > 0 ? endPageIndex : this._lastPageIndex;\n  }\n  pageSize() {\n    return this._dataOptions.pageSize();\n  }\n  load() {\n    var dataOptions = this._dataOptions;\n    var result;\n    var isVirtualMode = this._controller.isVirtualMode();\n    var isAppendMode = this._controller.isAppendMode();\n    if (false !== this.option(LEGACY_SCROLLING_MODE) && (isVirtualMode || isAppendMode)) {\n      var pageIndexForLoad = getPageIndexForLoad(this);\n      if (pageIndexForLoad >= 0) {\n        var loadResult = loadCore(this, pageIndexForLoad);\n        if (loadResult) {\n          result = new Deferred();\n          loadResult.done(() => {\n            var delayDeferred = this._delayDeferred;\n            if (delayDeferred) {\n              delayDeferred.done(result.resolve).fail(result.reject);\n            } else {\n              result.resolve();\n            }\n          }).fail(result.reject);\n          dataOptions.updateLoading();\n        }\n      }\n    } else {\n      result = dataOptions.load();\n    }\n    if (!result && this._lastPageIndex !== this.pageIndex()) {\n      this._dataOptions.onChanged({\n        changeType: \"pageIndex\"\n      });\n    }\n    return result || new Deferred().resolve();\n  }\n  loadIfNeed() {\n    var isVirtualMode = this._controller.isVirtualMode();\n    var isAppendMode = this._controller.isAppendMode();\n    if ((isVirtualMode || isAppendMode) && !this._dataOptions.isLoading() && (!this._isChangedFiring || this._controller.isVirtual())) {\n      var position = this._controller.getViewportPosition();\n      if (position > 0) {\n        this._controller._setViewportPositionCore(position);\n      } else {\n        this.load();\n      }\n    }\n  }\n  handleDataChanged(callBase, e) {\n    var dataOptions = this._dataOptions;\n    var lastCacheLength = this._cache.length;\n    var changeType;\n    var removeInvisiblePages;\n    var isVirtualMode = this._controller.isVirtualMode();\n    var isAppendMode = this._controller.isAppendMode();\n    if (e && e.changes) {\n      fireChanged(this, callBase, e);\n    } else if (false !== this.option(LEGACY_SCROLLING_MODE) && (isVirtualMode || isAppendMode)) {\n      var beginPageIndex = getBeginPageIndex(this);\n      if (beginPageIndex >= 0) {\n        if (isVirtualMode && beginPageIndex + this._cache.length !== dataOptions.pageIndex() && beginPageIndex - 1 !== dataOptions.pageIndex()) {\n          lastCacheLength = 0;\n          this._cache = [];\n        }\n        if (isAppendMode) {\n          if (0 === dataOptions.pageIndex()) {\n            this._cache = [];\n          } else if (dataOptions.pageIndex() < getEndPageIndex(this)) {\n            fireChanged(this, callBase, {\n              changeType: \"append\",\n              items: []\n            });\n            return;\n          }\n        }\n      }\n      var cacheItem = {\n        pageIndex: dataOptions.pageIndex(),\n        itemsLength: dataOptions.items(true).length,\n        itemsCount: this.itemsCount(true)\n      };\n      if (this.option(\"scrolling.removeInvisiblePages\") && isVirtualMode) {\n        removeInvisiblePages = this._cache.length > Math.max(getPreloadPageCount(this) + (this.option(\"scrolling.preloadEnabled\") ? 1 : 0), 2);\n      } else {\n        processDelayChanged(this, callBase, {\n          isDelayed: true\n        });\n      }\n      var removeCacheItem;\n      if (beginPageIndex === dataOptions.pageIndex() + 1) {\n        if (removeInvisiblePages) {\n          removeCacheItem = this._cache.pop();\n        }\n        changeType = \"prepend\";\n        this._cache.unshift(cacheItem);\n      } else {\n        if (removeInvisiblePages) {\n          removeCacheItem = this._cache.shift();\n        }\n        changeType = \"append\";\n        this._cache.push(cacheItem);\n      }\n      var isDelayChanged = isVirtualMode && 0 === lastCacheLength && needTwoPagesLoading(this);\n      processChanged(this, callBase, this._cache.length > 1 ? changeType : void 0, isDelayChanged, removeCacheItem);\n      this._delayDeferred = this.load().done(() => {\n        if (processDelayChanged(this, callBase)) {\n          this.load();\n        }\n      });\n    } else {\n      processChanged(this, callBase, e);\n    }\n  }\n  getDelayDeferred() {\n    return this._delayDeferred;\n  }\n  itemsCount(isBase) {\n    var itemsCount = 0;\n    var isVirtualMode = this._controller.isVirtualMode();\n    if (!isBase && isVirtualMode) {\n      this._cache.forEach(cacheItem => {\n        itemsCount += cacheItem.itemsCount;\n      });\n    } else {\n      itemsCount = this._dataOptions.itemsCount();\n    }\n    return itemsCount;\n  }\n  virtualItemsCount() {\n    var pageIndex = getBeginPageIndex(this);\n    if (pageIndex < 0) {\n      pageIndex = this._dataOptions.pageIndex();\n    }\n    var beginItemsCount = pageIndex * this._dataOptions.pageSize();\n    var itemsCount = this._cache.length * this._dataOptions.pageSize();\n    var endItemsCount = Math.max(0, this._dataOptions.totalItemsCount() - itemsCount - beginItemsCount);\n    return {\n      begin: beginItemsCount,\n      end: endItemsCount\n    };\n  }\n  reset() {\n    this._loadingPageIndexes = {};\n    this._cache = [];\n  }\n}","map":{"version":3,"names":["Deferred","when","isObject","isString","LEGACY_SCROLLING_MODE","needTwoPagesLoading","that","option","_controller","isVirtual","getViewportItemIndex","getBeginPageIndex","_cache","length","pageIndex","getEndPageIndex","fireChanged","changed","args","_isChangedFiring","processDelayChanged","_isDelayChanged","getViewportPageCount","pageSize","_dataOptions","preventPreload","realViewportSize","viewportSize","isVirtualMode","viewportItemSize","offset","getContentOffset","position","getViewportPosition","virtualItemsCount","totalItemsCount","itemIndex","begin","itemSize","getItemSizes","Math","ceil","getPreloadPageCount","previous","preloadEnabled","pageCount","isAppendMode","getPageIndexForLoad","result","beginPageIndex","dataOptions","_pageIndex","needToLoadPageBeforeLast","needToLoadPrevPage","needToLoadNextPage","_loadingPageIndexes","loadCore","isLoading","hasKnownLastPage","load","always","processChanged","changeType","isDelayChanged","removeCacheItem","items","slice","change","isPrepend","viewportItems","removeCount","itemsCount","correctCount","removeItemCount","itemsLength","push","apply","splice","unshift","updateLoading","_lastPageIndex","VirtualDataLoader","constructor","controller","arguments","viewportItemIndexChanged","virtualMode","appendMode","newPageIndex","lastPageSize","floor","maxPageIndex","max","min","defaultPageIndex","endPageIndex","pageIndexForLoad","loadResult","done","delayDeferred","_delayDeferred","resolve","fail","reject","onChanged","loadIfNeed","_setViewportPositionCore","handleDataChanged","callBase","e","lastCacheLength","removeInvisiblePages","changes","cacheItem","isDelayed","pop","shift","getDelayDeferred","isBase","forEach","beginItemsCount","endItemsCount","end","reset"],"sources":["C:/Users/ninad/OneDrive/Radna površina/zavrsni/client/node_modules/devextreme/esm/ui/grid_core/ui.grid.core.virtual_data_loader.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid.core.virtual_data_loader.js)\r\n * Version: 22.2.6\r\n * Build date: Tue Apr 18 2023\r\n *\r\n * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    Deferred,\r\n    when\r\n} from \"../../core/utils/deferred\";\r\nimport {\r\n    isObject,\r\n    isString\r\n} from \"../../core/utils/type\";\r\nvar LEGACY_SCROLLING_MODE = \"scrolling.legacyMode\";\r\nvar needTwoPagesLoading = that => that.option(\"scrolling.loadTwoPagesOnStart\") || that._controller.isVirtual() || that._controller.getViewportItemIndex() > 0;\r\nvar getBeginPageIndex = that => that._cache.length ? that._cache[0].pageIndex : -1;\r\nvar getEndPageIndex = that => that._cache.length ? that._cache[that._cache.length - 1].pageIndex : -1;\r\nvar fireChanged = (that, changed, args) => {\r\n    that._isChangedFiring = true;\r\n    changed(args);\r\n    that._isChangedFiring = false\r\n};\r\nvar processDelayChanged = (that, changed, args) => {\r\n    if (that._isDelayChanged) {\r\n        that._isDelayChanged = false;\r\n        fireChanged(that, changed, args);\r\n        return true\r\n    }\r\n};\r\nvar getViewportPageCount = that => {\r\n    var pageSize = that._dataOptions.pageSize();\r\n    var preventPreload = that.option(\"scrolling.preventPreload\");\r\n    if (preventPreload) {\r\n        return 0\r\n    }\r\n    var realViewportSize = that._controller.viewportSize();\r\n    if (that._controller.isVirtualMode() && that.option(\"scrolling.removeInvisiblePages\")) {\r\n        realViewportSize = 0;\r\n        var viewportSize = that._controller.viewportSize() * that._controller.viewportItemSize();\r\n        var offset = that._controller.getContentOffset();\r\n        var position = that._controller.getViewportPosition();\r\n        var virtualItemsCount = that._controller.virtualItemsCount();\r\n        var totalItemsCount = that._dataOptions.totalItemsCount();\r\n        for (var itemIndex = virtualItemsCount.begin; itemIndex < totalItemsCount; itemIndex++) {\r\n            if (offset >= position + viewportSize) {\r\n                break\r\n            }\r\n            var itemSize = that._controller.getItemSizes()[itemIndex] || that._controller.viewportItemSize();\r\n            offset += itemSize;\r\n            if (offset >= position) {\r\n                realViewportSize++\r\n            }\r\n        }\r\n    }\r\n    return pageSize && realViewportSize > 0 ? Math.ceil(realViewportSize / pageSize) : 1\r\n};\r\nvar getPreloadPageCount = (that, previous) => {\r\n    var preloadEnabled = that.option(\"scrolling.preloadEnabled\");\r\n    var pageCount = getViewportPageCount(that);\r\n    var isAppendMode = that._controller.isAppendMode();\r\n    if (pageCount) {\r\n        if (previous) {\r\n            pageCount = preloadEnabled ? 1 : 0\r\n        } else {\r\n            if (preloadEnabled) {\r\n                pageCount++\r\n            }\r\n            if (isAppendMode || !needTwoPagesLoading(that)) {\r\n                pageCount--\r\n            }\r\n        }\r\n    }\r\n    return pageCount\r\n};\r\nvar getPageIndexForLoad = that => {\r\n    var result = -1;\r\n    var beginPageIndex = getBeginPageIndex(that);\r\n    var dataOptions = that._dataOptions;\r\n    if (beginPageIndex < 0) {\r\n        result = that._pageIndex\r\n    } else if (!that._cache[that._pageIndex - beginPageIndex]) {\r\n        result = that._pageIndex\r\n    } else if (beginPageIndex >= 0 && that._controller.viewportSize() >= 0) {\r\n        if (beginPageIndex > 0) {\r\n            var needToLoadPageBeforeLast = getEndPageIndex(that) + 1 === dataOptions.pageCount() && that._cache.length < getPreloadPageCount(that) + 1;\r\n            var needToLoadPrevPage = needToLoadPageBeforeLast || that._pageIndex === beginPageIndex && getPreloadPageCount(that, true);\r\n            if (needToLoadPrevPage) {\r\n                result = beginPageIndex - 1\r\n            }\r\n        }\r\n        if (result < 0) {\r\n            var needToLoadNextPage = beginPageIndex + that._cache.length <= that._pageIndex + getPreloadPageCount(that);\r\n            if (needToLoadNextPage) {\r\n                result = beginPageIndex + that._cache.length\r\n            }\r\n        }\r\n    }\r\n    if (that._loadingPageIndexes[result]) {\r\n        result = -1\r\n    }\r\n    return result\r\n};\r\nvar loadCore = (that, pageIndex) => {\r\n    var dataOptions = that._dataOptions;\r\n    if (pageIndex === that.pageIndex() || !dataOptions.isLoading() && pageIndex < dataOptions.pageCount() || !dataOptions.hasKnownLastPage() && pageIndex === dataOptions.pageCount()) {\r\n        dataOptions.pageIndex(pageIndex);\r\n        that._loadingPageIndexes[pageIndex] = true;\r\n        return when(dataOptions.load()).always(() => {\r\n            that._loadingPageIndexes[pageIndex] = false\r\n        })\r\n    }\r\n};\r\nvar processChanged = (that, changed, changeType, isDelayChanged, removeCacheItem) => {\r\n    var dataOptions = that._dataOptions;\r\n    var items = dataOptions.items().slice();\r\n    var change = isObject(changeType) ? changeType : void 0;\r\n    var isPrepend = \"prepend\" === changeType;\r\n    var viewportItems = dataOptions.viewportItems();\r\n    if (changeType && isString(changeType) && !that._isDelayChanged) {\r\n        change = {\r\n            changeType: changeType,\r\n            items: items\r\n        };\r\n        if (removeCacheItem) {\r\n            change.removeCount = removeCacheItem.itemsCount;\r\n            if (change.removeCount && dataOptions.correctCount) {\r\n                change.removeCount = dataOptions.correctCount(viewportItems, change.removeCount, isPrepend)\r\n            }\r\n        }\r\n    }\r\n    var removeItemCount = removeCacheItem ? removeCacheItem.itemsLength : 0;\r\n    if (removeItemCount && dataOptions.correctCount) {\r\n        removeItemCount = dataOptions.correctCount(viewportItems, removeItemCount, isPrepend)\r\n    }\r\n    if (\"append\" === changeType) {\r\n        viewportItems.push.apply(viewportItems, items);\r\n        if (removeCacheItem) {\r\n            viewportItems.splice(0, removeItemCount)\r\n        }\r\n    } else if (isPrepend) {\r\n        viewportItems.unshift.apply(viewportItems, items);\r\n        if (removeCacheItem) {\r\n            viewportItems.splice(-removeItemCount)\r\n        }\r\n    } else {\r\n        that._dataOptions.viewportItems(items)\r\n    }\r\n    dataOptions.updateLoading();\r\n    that._lastPageIndex = that.pageIndex();\r\n    that._isDelayChanged = isDelayChanged;\r\n    if (!isDelayChanged) {\r\n        fireChanged(that, changed, change)\r\n    }\r\n};\r\nexport class VirtualDataLoader {\r\n    constructor(controller, dataOptions) {\r\n        this._controller = controller;\r\n        this._dataOptions = dataOptions;\r\n        this._pageIndex = this._lastPageIndex = dataOptions.pageIndex();\r\n        this._cache = [];\r\n        this._loadingPageIndexes = {}\r\n    }\r\n    option() {\r\n        return this._controller.option.apply(this._controller, arguments)\r\n    }\r\n    viewportItemIndexChanged(itemIndex) {\r\n        var pageSize = this._dataOptions.pageSize();\r\n        var pageCount = this._dataOptions.pageCount();\r\n        var virtualMode = this._controller.isVirtualMode();\r\n        var appendMode = this._controller.isAppendMode();\r\n        var totalItemsCount = this._dataOptions.totalItemsCount();\r\n        var newPageIndex;\r\n        if (pageSize && (virtualMode || appendMode) && totalItemsCount >= 0) {\r\n            var viewportSize = this._controller.viewportSize();\r\n            if (viewportSize && itemIndex + viewportSize >= totalItemsCount && !this._controller.isVirtual()) {\r\n                if (this._dataOptions.hasKnownLastPage()) {\r\n                    newPageIndex = pageCount - 1;\r\n                    var lastPageSize = totalItemsCount % pageSize;\r\n                    if (newPageIndex > 0 && lastPageSize > 0 && lastPageSize < viewportSize) {\r\n                        newPageIndex--\r\n                    }\r\n                } else {\r\n                    newPageIndex = pageCount\r\n                }\r\n            } else {\r\n                newPageIndex = Math.floor(itemIndex / pageSize);\r\n                var maxPageIndex = pageCount - 1;\r\n                newPageIndex = Math.max(newPageIndex, 0);\r\n                newPageIndex = Math.min(newPageIndex, maxPageIndex)\r\n            }\r\n            this.pageIndex(newPageIndex);\r\n            return this.load()\r\n        }\r\n    }\r\n    pageIndex(pageIndex) {\r\n        var isVirtualMode = this._controller.isVirtualMode();\r\n        var isAppendMode = this._controller.isAppendMode();\r\n        if (false !== this.option(LEGACY_SCROLLING_MODE) && (isVirtualMode || isAppendMode)) {\r\n            if (void 0 !== pageIndex) {\r\n                this._pageIndex = pageIndex\r\n            }\r\n            return this._pageIndex\r\n        } else {\r\n            return this._dataOptions.pageIndex(pageIndex)\r\n        }\r\n    }\r\n    beginPageIndex(defaultPageIndex) {\r\n        var beginPageIndex = getBeginPageIndex(this);\r\n        if (beginPageIndex < 0) {\r\n            beginPageIndex = void 0 !== defaultPageIndex ? defaultPageIndex : this.pageIndex()\r\n        }\r\n        return beginPageIndex\r\n    }\r\n    endPageIndex() {\r\n        var endPageIndex = getEndPageIndex(this);\r\n        return endPageIndex > 0 ? endPageIndex : this._lastPageIndex\r\n    }\r\n    pageSize() {\r\n        return this._dataOptions.pageSize()\r\n    }\r\n    load() {\r\n        var dataOptions = this._dataOptions;\r\n        var result;\r\n        var isVirtualMode = this._controller.isVirtualMode();\r\n        var isAppendMode = this._controller.isAppendMode();\r\n        if (false !== this.option(LEGACY_SCROLLING_MODE) && (isVirtualMode || isAppendMode)) {\r\n            var pageIndexForLoad = getPageIndexForLoad(this);\r\n            if (pageIndexForLoad >= 0) {\r\n                var loadResult = loadCore(this, pageIndexForLoad);\r\n                if (loadResult) {\r\n                    result = new Deferred;\r\n                    loadResult.done(() => {\r\n                        var delayDeferred = this._delayDeferred;\r\n                        if (delayDeferred) {\r\n                            delayDeferred.done(result.resolve).fail(result.reject)\r\n                        } else {\r\n                            result.resolve()\r\n                        }\r\n                    }).fail(result.reject);\r\n                    dataOptions.updateLoading()\r\n                }\r\n            }\r\n        } else {\r\n            result = dataOptions.load()\r\n        }\r\n        if (!result && this._lastPageIndex !== this.pageIndex()) {\r\n            this._dataOptions.onChanged({\r\n                changeType: \"pageIndex\"\r\n            })\r\n        }\r\n        return result || (new Deferred).resolve()\r\n    }\r\n    loadIfNeed() {\r\n        var isVirtualMode = this._controller.isVirtualMode();\r\n        var isAppendMode = this._controller.isAppendMode();\r\n        if ((isVirtualMode || isAppendMode) && !this._dataOptions.isLoading() && (!this._isChangedFiring || this._controller.isVirtual())) {\r\n            var position = this._controller.getViewportPosition();\r\n            if (position > 0) {\r\n                this._controller._setViewportPositionCore(position)\r\n            } else {\r\n                this.load()\r\n            }\r\n        }\r\n    }\r\n    handleDataChanged(callBase, e) {\r\n        var dataOptions = this._dataOptions;\r\n        var lastCacheLength = this._cache.length;\r\n        var changeType;\r\n        var removeInvisiblePages;\r\n        var isVirtualMode = this._controller.isVirtualMode();\r\n        var isAppendMode = this._controller.isAppendMode();\r\n        if (e && e.changes) {\r\n            fireChanged(this, callBase, e)\r\n        } else if (false !== this.option(LEGACY_SCROLLING_MODE) && (isVirtualMode || isAppendMode)) {\r\n            var beginPageIndex = getBeginPageIndex(this);\r\n            if (beginPageIndex >= 0) {\r\n                if (isVirtualMode && beginPageIndex + this._cache.length !== dataOptions.pageIndex() && beginPageIndex - 1 !== dataOptions.pageIndex()) {\r\n                    lastCacheLength = 0;\r\n                    this._cache = []\r\n                }\r\n                if (isAppendMode) {\r\n                    if (0 === dataOptions.pageIndex()) {\r\n                        this._cache = []\r\n                    } else if (dataOptions.pageIndex() < getEndPageIndex(this)) {\r\n                        fireChanged(this, callBase, {\r\n                            changeType: \"append\",\r\n                            items: []\r\n                        });\r\n                        return\r\n                    }\r\n                }\r\n            }\r\n            var cacheItem = {\r\n                pageIndex: dataOptions.pageIndex(),\r\n                itemsLength: dataOptions.items(true).length,\r\n                itemsCount: this.itemsCount(true)\r\n            };\r\n            if (this.option(\"scrolling.removeInvisiblePages\") && isVirtualMode) {\r\n                removeInvisiblePages = this._cache.length > Math.max(getPreloadPageCount(this) + (this.option(\"scrolling.preloadEnabled\") ? 1 : 0), 2)\r\n            } else {\r\n                processDelayChanged(this, callBase, {\r\n                    isDelayed: true\r\n                })\r\n            }\r\n            var removeCacheItem;\r\n            if (beginPageIndex === dataOptions.pageIndex() + 1) {\r\n                if (removeInvisiblePages) {\r\n                    removeCacheItem = this._cache.pop()\r\n                }\r\n                changeType = \"prepend\";\r\n                this._cache.unshift(cacheItem)\r\n            } else {\r\n                if (removeInvisiblePages) {\r\n                    removeCacheItem = this._cache.shift()\r\n                }\r\n                changeType = \"append\";\r\n                this._cache.push(cacheItem)\r\n            }\r\n            var isDelayChanged = isVirtualMode && 0 === lastCacheLength && needTwoPagesLoading(this);\r\n            processChanged(this, callBase, this._cache.length > 1 ? changeType : void 0, isDelayChanged, removeCacheItem);\r\n            this._delayDeferred = this.load().done(() => {\r\n                if (processDelayChanged(this, callBase)) {\r\n                    this.load()\r\n                }\r\n            })\r\n        } else {\r\n            processChanged(this, callBase, e)\r\n        }\r\n    }\r\n    getDelayDeferred() {\r\n        return this._delayDeferred\r\n    }\r\n    itemsCount(isBase) {\r\n        var itemsCount = 0;\r\n        var isVirtualMode = this._controller.isVirtualMode();\r\n        if (!isBase && isVirtualMode) {\r\n            this._cache.forEach(cacheItem => {\r\n                itemsCount += cacheItem.itemsCount\r\n            })\r\n        } else {\r\n            itemsCount = this._dataOptions.itemsCount()\r\n        }\r\n        return itemsCount\r\n    }\r\n    virtualItemsCount() {\r\n        var pageIndex = getBeginPageIndex(this);\r\n        if (pageIndex < 0) {\r\n            pageIndex = this._dataOptions.pageIndex()\r\n        }\r\n        var beginItemsCount = pageIndex * this._dataOptions.pageSize();\r\n        var itemsCount = this._cache.length * this._dataOptions.pageSize();\r\n        var endItemsCount = Math.max(0, this._dataOptions.totalItemsCount() - itemsCount - beginItemsCount);\r\n        return {\r\n            begin: beginItemsCount,\r\n            end: endItemsCount\r\n        }\r\n    }\r\n    reset() {\r\n        this._loadingPageIndexes = {};\r\n        this._cache = []\r\n    }\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SACIA,QAAQ,EACRC,IAAI,QACD,2BAA2B;AAClC,SACIC,QAAQ,EACRC,QAAQ,QACL,uBAAuB;AAC9B,IAAIC,qBAAqB,GAAG,sBAAsB;AAClD,IAAIC,mBAAmB,GAAGC,IAAI,IAAIA,IAAI,CAACC,MAAM,CAAC,+BAA+B,CAAC,IAAID,IAAI,CAACE,WAAW,CAACC,SAAS,CAAC,CAAC,IAAIH,IAAI,CAACE,WAAW,CAACE,oBAAoB,CAAC,CAAC,GAAG,CAAC;AAC7J,IAAIC,iBAAiB,GAAGL,IAAI,IAAIA,IAAI,CAACM,MAAM,CAACC,MAAM,GAAGP,IAAI,CAACM,MAAM,CAAC,CAAC,CAAC,CAACE,SAAS,GAAG,CAAC,CAAC;AAClF,IAAIC,eAAe,GAAGT,IAAI,IAAIA,IAAI,CAACM,MAAM,CAACC,MAAM,GAAGP,IAAI,CAACM,MAAM,CAACN,IAAI,CAACM,MAAM,CAACC,MAAM,GAAG,CAAC,CAAC,CAACC,SAAS,GAAG,CAAC,CAAC;AACrG,IAAIE,WAAW,GAAGA,CAACV,IAAI,EAAEW,OAAO,EAAEC,IAAI,KAAK;EACvCZ,IAAI,CAACa,gBAAgB,GAAG,IAAI;EAC5BF,OAAO,CAACC,IAAI,CAAC;EACbZ,IAAI,CAACa,gBAAgB,GAAG,KAAK;AACjC,CAAC;AACD,IAAIC,mBAAmB,GAAGA,CAACd,IAAI,EAAEW,OAAO,EAAEC,IAAI,KAAK;EAC/C,IAAIZ,IAAI,CAACe,eAAe,EAAE;IACtBf,IAAI,CAACe,eAAe,GAAG,KAAK;IAC5BL,WAAW,CAACV,IAAI,EAAEW,OAAO,EAAEC,IAAI,CAAC;IAChC,OAAO,IAAI;EACf;AACJ,CAAC;AACD,IAAII,oBAAoB,GAAGhB,IAAI,IAAI;EAC/B,IAAIiB,QAAQ,GAAGjB,IAAI,CAACkB,YAAY,CAACD,QAAQ,CAAC,CAAC;EAC3C,IAAIE,cAAc,GAAGnB,IAAI,CAACC,MAAM,CAAC,0BAA0B,CAAC;EAC5D,IAAIkB,cAAc,EAAE;IAChB,OAAO,CAAC;EACZ;EACA,IAAIC,gBAAgB,GAAGpB,IAAI,CAACE,WAAW,CAACmB,YAAY,CAAC,CAAC;EACtD,IAAIrB,IAAI,CAACE,WAAW,CAACoB,aAAa,CAAC,CAAC,IAAItB,IAAI,CAACC,MAAM,CAAC,gCAAgC,CAAC,EAAE;IACnFmB,gBAAgB,GAAG,CAAC;IACpB,IAAIC,YAAY,GAAGrB,IAAI,CAACE,WAAW,CAACmB,YAAY,CAAC,CAAC,GAAGrB,IAAI,CAACE,WAAW,CAACqB,gBAAgB,CAAC,CAAC;IACxF,IAAIC,MAAM,GAAGxB,IAAI,CAACE,WAAW,CAACuB,gBAAgB,CAAC,CAAC;IAChD,IAAIC,QAAQ,GAAG1B,IAAI,CAACE,WAAW,CAACyB,mBAAmB,CAAC,CAAC;IACrD,IAAIC,iBAAiB,GAAG5B,IAAI,CAACE,WAAW,CAAC0B,iBAAiB,CAAC,CAAC;IAC5D,IAAIC,eAAe,GAAG7B,IAAI,CAACkB,YAAY,CAACW,eAAe,CAAC,CAAC;IACzD,KAAK,IAAIC,SAAS,GAAGF,iBAAiB,CAACG,KAAK,EAAED,SAAS,GAAGD,eAAe,EAAEC,SAAS,EAAE,EAAE;MACpF,IAAIN,MAAM,IAAIE,QAAQ,GAAGL,YAAY,EAAE;QACnC;MACJ;MACA,IAAIW,QAAQ,GAAGhC,IAAI,CAACE,WAAW,CAAC+B,YAAY,CAAC,CAAC,CAACH,SAAS,CAAC,IAAI9B,IAAI,CAACE,WAAW,CAACqB,gBAAgB,CAAC,CAAC;MAChGC,MAAM,IAAIQ,QAAQ;MAClB,IAAIR,MAAM,IAAIE,QAAQ,EAAE;QACpBN,gBAAgB,EAAE;MACtB;IACJ;EACJ;EACA,OAAOH,QAAQ,IAAIG,gBAAgB,GAAG,CAAC,GAAGc,IAAI,CAACC,IAAI,CAACf,gBAAgB,GAAGH,QAAQ,CAAC,GAAG,CAAC;AACxF,CAAC;AACD,IAAImB,mBAAmB,GAAGA,CAACpC,IAAI,EAAEqC,QAAQ,KAAK;EAC1C,IAAIC,cAAc,GAAGtC,IAAI,CAACC,MAAM,CAAC,0BAA0B,CAAC;EAC5D,IAAIsC,SAAS,GAAGvB,oBAAoB,CAAChB,IAAI,CAAC;EAC1C,IAAIwC,YAAY,GAAGxC,IAAI,CAACE,WAAW,CAACsC,YAAY,CAAC,CAAC;EAClD,IAAID,SAAS,EAAE;IACX,IAAIF,QAAQ,EAAE;MACVE,SAAS,GAAGD,cAAc,GAAG,CAAC,GAAG,CAAC;IACtC,CAAC,MAAM;MACH,IAAIA,cAAc,EAAE;QAChBC,SAAS,EAAE;MACf;MACA,IAAIC,YAAY,IAAI,CAACzC,mBAAmB,CAACC,IAAI,CAAC,EAAE;QAC5CuC,SAAS,EAAE;MACf;IACJ;EACJ;EACA,OAAOA,SAAS;AACpB,CAAC;AACD,IAAIE,mBAAmB,GAAGzC,IAAI,IAAI;EAC9B,IAAI0C,MAAM,GAAG,CAAC,CAAC;EACf,IAAIC,cAAc,GAAGtC,iBAAiB,CAACL,IAAI,CAAC;EAC5C,IAAI4C,WAAW,GAAG5C,IAAI,CAACkB,YAAY;EACnC,IAAIyB,cAAc,GAAG,CAAC,EAAE;IACpBD,MAAM,GAAG1C,IAAI,CAAC6C,UAAU;EAC5B,CAAC,MAAM,IAAI,CAAC7C,IAAI,CAACM,MAAM,CAACN,IAAI,CAAC6C,UAAU,GAAGF,cAAc,CAAC,EAAE;IACvDD,MAAM,GAAG1C,IAAI,CAAC6C,UAAU;EAC5B,CAAC,MAAM,IAAIF,cAAc,IAAI,CAAC,IAAI3C,IAAI,CAACE,WAAW,CAACmB,YAAY,CAAC,CAAC,IAAI,CAAC,EAAE;IACpE,IAAIsB,cAAc,GAAG,CAAC,EAAE;MACpB,IAAIG,wBAAwB,GAAGrC,eAAe,CAACT,IAAI,CAAC,GAAG,CAAC,KAAK4C,WAAW,CAACL,SAAS,CAAC,CAAC,IAAIvC,IAAI,CAACM,MAAM,CAACC,MAAM,GAAG6B,mBAAmB,CAACpC,IAAI,CAAC,GAAG,CAAC;MAC1I,IAAI+C,kBAAkB,GAAGD,wBAAwB,IAAI9C,IAAI,CAAC6C,UAAU,KAAKF,cAAc,IAAIP,mBAAmB,CAACpC,IAAI,EAAE,IAAI,CAAC;MAC1H,IAAI+C,kBAAkB,EAAE;QACpBL,MAAM,GAAGC,cAAc,GAAG,CAAC;MAC/B;IACJ;IACA,IAAID,MAAM,GAAG,CAAC,EAAE;MACZ,IAAIM,kBAAkB,GAAGL,cAAc,GAAG3C,IAAI,CAACM,MAAM,CAACC,MAAM,IAAIP,IAAI,CAAC6C,UAAU,GAAGT,mBAAmB,CAACpC,IAAI,CAAC;MAC3G,IAAIgD,kBAAkB,EAAE;QACpBN,MAAM,GAAGC,cAAc,GAAG3C,IAAI,CAACM,MAAM,CAACC,MAAM;MAChD;IACJ;EACJ;EACA,IAAIP,IAAI,CAACiD,mBAAmB,CAACP,MAAM,CAAC,EAAE;IAClCA,MAAM,GAAG,CAAC,CAAC;EACf;EACA,OAAOA,MAAM;AACjB,CAAC;AACD,IAAIQ,QAAQ,GAAGA,CAAClD,IAAI,EAAEQ,SAAS,KAAK;EAChC,IAAIoC,WAAW,GAAG5C,IAAI,CAACkB,YAAY;EACnC,IAAIV,SAAS,KAAKR,IAAI,CAACQ,SAAS,CAAC,CAAC,IAAI,CAACoC,WAAW,CAACO,SAAS,CAAC,CAAC,IAAI3C,SAAS,GAAGoC,WAAW,CAACL,SAAS,CAAC,CAAC,IAAI,CAACK,WAAW,CAACQ,gBAAgB,CAAC,CAAC,IAAI5C,SAAS,KAAKoC,WAAW,CAACL,SAAS,CAAC,CAAC,EAAE;IAC/KK,WAAW,CAACpC,SAAS,CAACA,SAAS,CAAC;IAChCR,IAAI,CAACiD,mBAAmB,CAACzC,SAAS,CAAC,GAAG,IAAI;IAC1C,OAAOb,IAAI,CAACiD,WAAW,CAACS,IAAI,CAAC,CAAC,CAAC,CAACC,MAAM,CAAC,MAAM;MACzCtD,IAAI,CAACiD,mBAAmB,CAACzC,SAAS,CAAC,GAAG,KAAK;IAC/C,CAAC,CAAC;EACN;AACJ,CAAC;AACD,IAAI+C,cAAc,GAAGA,CAACvD,IAAI,EAAEW,OAAO,EAAE6C,UAAU,EAAEC,cAAc,EAAEC,eAAe,KAAK;EACjF,IAAId,WAAW,GAAG5C,IAAI,CAACkB,YAAY;EACnC,IAAIyC,KAAK,GAAGf,WAAW,CAACe,KAAK,CAAC,CAAC,CAACC,KAAK,CAAC,CAAC;EACvC,IAAIC,MAAM,GAAGjE,QAAQ,CAAC4D,UAAU,CAAC,GAAGA,UAAU,GAAG,KAAK,CAAC;EACvD,IAAIM,SAAS,GAAG,SAAS,KAAKN,UAAU;EACxC,IAAIO,aAAa,GAAGnB,WAAW,CAACmB,aAAa,CAAC,CAAC;EAC/C,IAAIP,UAAU,IAAI3D,QAAQ,CAAC2D,UAAU,CAAC,IAAI,CAACxD,IAAI,CAACe,eAAe,EAAE;IAC7D8C,MAAM,GAAG;MACLL,UAAU,EAAEA,UAAU;MACtBG,KAAK,EAAEA;IACX,CAAC;IACD,IAAID,eAAe,EAAE;MACjBG,MAAM,CAACG,WAAW,GAAGN,eAAe,CAACO,UAAU;MAC/C,IAAIJ,MAAM,CAACG,WAAW,IAAIpB,WAAW,CAACsB,YAAY,EAAE;QAChDL,MAAM,CAACG,WAAW,GAAGpB,WAAW,CAACsB,YAAY,CAACH,aAAa,EAAEF,MAAM,CAACG,WAAW,EAAEF,SAAS,CAAC;MAC/F;IACJ;EACJ;EACA,IAAIK,eAAe,GAAGT,eAAe,GAAGA,eAAe,CAACU,WAAW,GAAG,CAAC;EACvE,IAAID,eAAe,IAAIvB,WAAW,CAACsB,YAAY,EAAE;IAC7CC,eAAe,GAAGvB,WAAW,CAACsB,YAAY,CAACH,aAAa,EAAEI,eAAe,EAAEL,SAAS,CAAC;EACzF;EACA,IAAI,QAAQ,KAAKN,UAAU,EAAE;IACzBO,aAAa,CAACM,IAAI,CAACC,KAAK,CAACP,aAAa,EAAEJ,KAAK,CAAC;IAC9C,IAAID,eAAe,EAAE;MACjBK,aAAa,CAACQ,MAAM,CAAC,CAAC,EAAEJ,eAAe,CAAC;IAC5C;EACJ,CAAC,MAAM,IAAIL,SAAS,EAAE;IAClBC,aAAa,CAACS,OAAO,CAACF,KAAK,CAACP,aAAa,EAAEJ,KAAK,CAAC;IACjD,IAAID,eAAe,EAAE;MACjBK,aAAa,CAACQ,MAAM,CAAC,CAACJ,eAAe,CAAC;IAC1C;EACJ,CAAC,MAAM;IACHnE,IAAI,CAACkB,YAAY,CAAC6C,aAAa,CAACJ,KAAK,CAAC;EAC1C;EACAf,WAAW,CAAC6B,aAAa,CAAC,CAAC;EAC3BzE,IAAI,CAAC0E,cAAc,GAAG1E,IAAI,CAACQ,SAAS,CAAC,CAAC;EACtCR,IAAI,CAACe,eAAe,GAAG0C,cAAc;EACrC,IAAI,CAACA,cAAc,EAAE;IACjB/C,WAAW,CAACV,IAAI,EAAEW,OAAO,EAAEkD,MAAM,CAAC;EACtC;AACJ,CAAC;AACD,OAAO,MAAMc,iBAAiB,CAAC;EAC3BC,WAAWA,CAACC,UAAU,EAAEjC,WAAW,EAAE;IACjC,IAAI,CAAC1C,WAAW,GAAG2E,UAAU;IAC7B,IAAI,CAAC3D,YAAY,GAAG0B,WAAW;IAC/B,IAAI,CAACC,UAAU,GAAG,IAAI,CAAC6B,cAAc,GAAG9B,WAAW,CAACpC,SAAS,CAAC,CAAC;IAC/D,IAAI,CAACF,MAAM,GAAG,EAAE;IAChB,IAAI,CAAC2C,mBAAmB,GAAG,CAAC,CAAC;EACjC;EACAhD,MAAMA,CAAA,EAAG;IACL,OAAO,IAAI,CAACC,WAAW,CAACD,MAAM,CAACqE,KAAK,CAAC,IAAI,CAACpE,WAAW,EAAE4E,SAAS,CAAC;EACrE;EACAC,wBAAwBA,CAACjD,SAAS,EAAE;IAChC,IAAIb,QAAQ,GAAG,IAAI,CAACC,YAAY,CAACD,QAAQ,CAAC,CAAC;IAC3C,IAAIsB,SAAS,GAAG,IAAI,CAACrB,YAAY,CAACqB,SAAS,CAAC,CAAC;IAC7C,IAAIyC,WAAW,GAAG,IAAI,CAAC9E,WAAW,CAACoB,aAAa,CAAC,CAAC;IAClD,IAAI2D,UAAU,GAAG,IAAI,CAAC/E,WAAW,CAACsC,YAAY,CAAC,CAAC;IAChD,IAAIX,eAAe,GAAG,IAAI,CAACX,YAAY,CAACW,eAAe,CAAC,CAAC;IACzD,IAAIqD,YAAY;IAChB,IAAIjE,QAAQ,KAAK+D,WAAW,IAAIC,UAAU,CAAC,IAAIpD,eAAe,IAAI,CAAC,EAAE;MACjE,IAAIR,YAAY,GAAG,IAAI,CAACnB,WAAW,CAACmB,YAAY,CAAC,CAAC;MAClD,IAAIA,YAAY,IAAIS,SAAS,GAAGT,YAAY,IAAIQ,eAAe,IAAI,CAAC,IAAI,CAAC3B,WAAW,CAACC,SAAS,CAAC,CAAC,EAAE;QAC9F,IAAI,IAAI,CAACe,YAAY,CAACkC,gBAAgB,CAAC,CAAC,EAAE;UACtC8B,YAAY,GAAG3C,SAAS,GAAG,CAAC;UAC5B,IAAI4C,YAAY,GAAGtD,eAAe,GAAGZ,QAAQ;UAC7C,IAAIiE,YAAY,GAAG,CAAC,IAAIC,YAAY,GAAG,CAAC,IAAIA,YAAY,GAAG9D,YAAY,EAAE;YACrE6D,YAAY,EAAE;UAClB;QACJ,CAAC,MAAM;UACHA,YAAY,GAAG3C,SAAS;QAC5B;MACJ,CAAC,MAAM;QACH2C,YAAY,GAAGhD,IAAI,CAACkD,KAAK,CAACtD,SAAS,GAAGb,QAAQ,CAAC;QAC/C,IAAIoE,YAAY,GAAG9C,SAAS,GAAG,CAAC;QAChC2C,YAAY,GAAGhD,IAAI,CAACoD,GAAG,CAACJ,YAAY,EAAE,CAAC,CAAC;QACxCA,YAAY,GAAGhD,IAAI,CAACqD,GAAG,CAACL,YAAY,EAAEG,YAAY,CAAC;MACvD;MACA,IAAI,CAAC7E,SAAS,CAAC0E,YAAY,CAAC;MAC5B,OAAO,IAAI,CAAC7B,IAAI,CAAC,CAAC;IACtB;EACJ;EACA7C,SAASA,CAACA,SAAS,EAAE;IACjB,IAAIc,aAAa,GAAG,IAAI,CAACpB,WAAW,CAACoB,aAAa,CAAC,CAAC;IACpD,IAAIkB,YAAY,GAAG,IAAI,CAACtC,WAAW,CAACsC,YAAY,CAAC,CAAC;IAClD,IAAI,KAAK,KAAK,IAAI,CAACvC,MAAM,CAACH,qBAAqB,CAAC,KAAKwB,aAAa,IAAIkB,YAAY,CAAC,EAAE;MACjF,IAAI,KAAK,CAAC,KAAKhC,SAAS,EAAE;QACtB,IAAI,CAACqC,UAAU,GAAGrC,SAAS;MAC/B;MACA,OAAO,IAAI,CAACqC,UAAU;IAC1B,CAAC,MAAM;MACH,OAAO,IAAI,CAAC3B,YAAY,CAACV,SAAS,CAACA,SAAS,CAAC;IACjD;EACJ;EACAmC,cAAcA,CAAC6C,gBAAgB,EAAE;IAC7B,IAAI7C,cAAc,GAAGtC,iBAAiB,CAAC,IAAI,CAAC;IAC5C,IAAIsC,cAAc,GAAG,CAAC,EAAE;MACpBA,cAAc,GAAG,KAAK,CAAC,KAAK6C,gBAAgB,GAAGA,gBAAgB,GAAG,IAAI,CAAChF,SAAS,CAAC,CAAC;IACtF;IACA,OAAOmC,cAAc;EACzB;EACA8C,YAAYA,CAAA,EAAG;IACX,IAAIA,YAAY,GAAGhF,eAAe,CAAC,IAAI,CAAC;IACxC,OAAOgF,YAAY,GAAG,CAAC,GAAGA,YAAY,GAAG,IAAI,CAACf,cAAc;EAChE;EACAzD,QAAQA,CAAA,EAAG;IACP,OAAO,IAAI,CAACC,YAAY,CAACD,QAAQ,CAAC,CAAC;EACvC;EACAoC,IAAIA,CAAA,EAAG;IACH,IAAIT,WAAW,GAAG,IAAI,CAAC1B,YAAY;IACnC,IAAIwB,MAAM;IACV,IAAIpB,aAAa,GAAG,IAAI,CAACpB,WAAW,CAACoB,aAAa,CAAC,CAAC;IACpD,IAAIkB,YAAY,GAAG,IAAI,CAACtC,WAAW,CAACsC,YAAY,CAAC,CAAC;IAClD,IAAI,KAAK,KAAK,IAAI,CAACvC,MAAM,CAACH,qBAAqB,CAAC,KAAKwB,aAAa,IAAIkB,YAAY,CAAC,EAAE;MACjF,IAAIkD,gBAAgB,GAAGjD,mBAAmB,CAAC,IAAI,CAAC;MAChD,IAAIiD,gBAAgB,IAAI,CAAC,EAAE;QACvB,IAAIC,UAAU,GAAGzC,QAAQ,CAAC,IAAI,EAAEwC,gBAAgB,CAAC;QACjD,IAAIC,UAAU,EAAE;UACZjD,MAAM,GAAG,IAAIhD,QAAQ,CAAD,CAAC;UACrBiG,UAAU,CAACC,IAAI,CAAC,MAAM;YAClB,IAAIC,aAAa,GAAG,IAAI,CAACC,cAAc;YACvC,IAAID,aAAa,EAAE;cACfA,aAAa,CAACD,IAAI,CAAClD,MAAM,CAACqD,OAAO,CAAC,CAACC,IAAI,CAACtD,MAAM,CAACuD,MAAM,CAAC;YAC1D,CAAC,MAAM;cACHvD,MAAM,CAACqD,OAAO,CAAC,CAAC;YACpB;UACJ,CAAC,CAAC,CAACC,IAAI,CAACtD,MAAM,CAACuD,MAAM,CAAC;UACtBrD,WAAW,CAAC6B,aAAa,CAAC,CAAC;QAC/B;MACJ;IACJ,CAAC,MAAM;MACH/B,MAAM,GAAGE,WAAW,CAACS,IAAI,CAAC,CAAC;IAC/B;IACA,IAAI,CAACX,MAAM,IAAI,IAAI,CAACgC,cAAc,KAAK,IAAI,CAAClE,SAAS,CAAC,CAAC,EAAE;MACrD,IAAI,CAACU,YAAY,CAACgF,SAAS,CAAC;QACxB1C,UAAU,EAAE;MAChB,CAAC,CAAC;IACN;IACA,OAAOd,MAAM,IAAK,IAAIhD,QAAQ,CAAD,CAAC,CAAEqG,OAAO,CAAC,CAAC;EAC7C;EACAI,UAAUA,CAAA,EAAG;IACT,IAAI7E,aAAa,GAAG,IAAI,CAACpB,WAAW,CAACoB,aAAa,CAAC,CAAC;IACpD,IAAIkB,YAAY,GAAG,IAAI,CAACtC,WAAW,CAACsC,YAAY,CAAC,CAAC;IAClD,IAAI,CAAClB,aAAa,IAAIkB,YAAY,KAAK,CAAC,IAAI,CAACtB,YAAY,CAACiC,SAAS,CAAC,CAAC,KAAK,CAAC,IAAI,CAACtC,gBAAgB,IAAI,IAAI,CAACX,WAAW,CAACC,SAAS,CAAC,CAAC,CAAC,EAAE;MAC/H,IAAIuB,QAAQ,GAAG,IAAI,CAACxB,WAAW,CAACyB,mBAAmB,CAAC,CAAC;MACrD,IAAID,QAAQ,GAAG,CAAC,EAAE;QACd,IAAI,CAACxB,WAAW,CAACkG,wBAAwB,CAAC1E,QAAQ,CAAC;MACvD,CAAC,MAAM;QACH,IAAI,CAAC2B,IAAI,CAAC,CAAC;MACf;IACJ;EACJ;EACAgD,iBAAiBA,CAACC,QAAQ,EAAEC,CAAC,EAAE;IAC3B,IAAI3D,WAAW,GAAG,IAAI,CAAC1B,YAAY;IACnC,IAAIsF,eAAe,GAAG,IAAI,CAAClG,MAAM,CAACC,MAAM;IACxC,IAAIiD,UAAU;IACd,IAAIiD,oBAAoB;IACxB,IAAInF,aAAa,GAAG,IAAI,CAACpB,WAAW,CAACoB,aAAa,CAAC,CAAC;IACpD,IAAIkB,YAAY,GAAG,IAAI,CAACtC,WAAW,CAACsC,YAAY,CAAC,CAAC;IAClD,IAAI+D,CAAC,IAAIA,CAAC,CAACG,OAAO,EAAE;MAChBhG,WAAW,CAAC,IAAI,EAAE4F,QAAQ,EAAEC,CAAC,CAAC;IAClC,CAAC,MAAM,IAAI,KAAK,KAAK,IAAI,CAACtG,MAAM,CAACH,qBAAqB,CAAC,KAAKwB,aAAa,IAAIkB,YAAY,CAAC,EAAE;MACxF,IAAIG,cAAc,GAAGtC,iBAAiB,CAAC,IAAI,CAAC;MAC5C,IAAIsC,cAAc,IAAI,CAAC,EAAE;QACrB,IAAIrB,aAAa,IAAIqB,cAAc,GAAG,IAAI,CAACrC,MAAM,CAACC,MAAM,KAAKqC,WAAW,CAACpC,SAAS,CAAC,CAAC,IAAImC,cAAc,GAAG,CAAC,KAAKC,WAAW,CAACpC,SAAS,CAAC,CAAC,EAAE;UACpIgG,eAAe,GAAG,CAAC;UACnB,IAAI,CAAClG,MAAM,GAAG,EAAE;QACpB;QACA,IAAIkC,YAAY,EAAE;UACd,IAAI,CAAC,KAAKI,WAAW,CAACpC,SAAS,CAAC,CAAC,EAAE;YAC/B,IAAI,CAACF,MAAM,GAAG,EAAE;UACpB,CAAC,MAAM,IAAIsC,WAAW,CAACpC,SAAS,CAAC,CAAC,GAAGC,eAAe,CAAC,IAAI,CAAC,EAAE;YACxDC,WAAW,CAAC,IAAI,EAAE4F,QAAQ,EAAE;cACxB9C,UAAU,EAAE,QAAQ;cACpBG,KAAK,EAAE;YACX,CAAC,CAAC;YACF;UACJ;QACJ;MACJ;MACA,IAAIgD,SAAS,GAAG;QACZnG,SAAS,EAAEoC,WAAW,CAACpC,SAAS,CAAC,CAAC;QAClC4D,WAAW,EAAExB,WAAW,CAACe,KAAK,CAAC,IAAI,CAAC,CAACpD,MAAM;QAC3C0D,UAAU,EAAE,IAAI,CAACA,UAAU,CAAC,IAAI;MACpC,CAAC;MACD,IAAI,IAAI,CAAChE,MAAM,CAAC,gCAAgC,CAAC,IAAIqB,aAAa,EAAE;QAChEmF,oBAAoB,GAAG,IAAI,CAACnG,MAAM,CAACC,MAAM,GAAG2B,IAAI,CAACoD,GAAG,CAAClD,mBAAmB,CAAC,IAAI,CAAC,IAAI,IAAI,CAACnC,MAAM,CAAC,0BAA0B,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;MAC1I,CAAC,MAAM;QACHa,mBAAmB,CAAC,IAAI,EAAEwF,QAAQ,EAAE;UAChCM,SAAS,EAAE;QACf,CAAC,CAAC;MACN;MACA,IAAIlD,eAAe;MACnB,IAAIf,cAAc,KAAKC,WAAW,CAACpC,SAAS,CAAC,CAAC,GAAG,CAAC,EAAE;QAChD,IAAIiG,oBAAoB,EAAE;UACtB/C,eAAe,GAAG,IAAI,CAACpD,MAAM,CAACuG,GAAG,CAAC,CAAC;QACvC;QACArD,UAAU,GAAG,SAAS;QACtB,IAAI,CAAClD,MAAM,CAACkE,OAAO,CAACmC,SAAS,CAAC;MAClC,CAAC,MAAM;QACH,IAAIF,oBAAoB,EAAE;UACtB/C,eAAe,GAAG,IAAI,CAACpD,MAAM,CAACwG,KAAK,CAAC,CAAC;QACzC;QACAtD,UAAU,GAAG,QAAQ;QACrB,IAAI,CAAClD,MAAM,CAAC+D,IAAI,CAACsC,SAAS,CAAC;MAC/B;MACA,IAAIlD,cAAc,GAAGnC,aAAa,IAAI,CAAC,KAAKkF,eAAe,IAAIzG,mBAAmB,CAAC,IAAI,CAAC;MACxFwD,cAAc,CAAC,IAAI,EAAE+C,QAAQ,EAAE,IAAI,CAAChG,MAAM,CAACC,MAAM,GAAG,CAAC,GAAGiD,UAAU,GAAG,KAAK,CAAC,EAAEC,cAAc,EAAEC,eAAe,CAAC;MAC7G,IAAI,CAACoC,cAAc,GAAG,IAAI,CAACzC,IAAI,CAAC,CAAC,CAACuC,IAAI,CAAC,MAAM;QACzC,IAAI9E,mBAAmB,CAAC,IAAI,EAAEwF,QAAQ,CAAC,EAAE;UACrC,IAAI,CAACjD,IAAI,CAAC,CAAC;QACf;MACJ,CAAC,CAAC;IACN,CAAC,MAAM;MACHE,cAAc,CAAC,IAAI,EAAE+C,QAAQ,EAAEC,CAAC,CAAC;IACrC;EACJ;EACAQ,gBAAgBA,CAAA,EAAG;IACf,OAAO,IAAI,CAACjB,cAAc;EAC9B;EACA7B,UAAUA,CAAC+C,MAAM,EAAE;IACf,IAAI/C,UAAU,GAAG,CAAC;IAClB,IAAI3C,aAAa,GAAG,IAAI,CAACpB,WAAW,CAACoB,aAAa,CAAC,CAAC;IACpD,IAAI,CAAC0F,MAAM,IAAI1F,aAAa,EAAE;MAC1B,IAAI,CAAChB,MAAM,CAAC2G,OAAO,CAACN,SAAS,IAAI;QAC7B1C,UAAU,IAAI0C,SAAS,CAAC1C,UAAU;MACtC,CAAC,CAAC;IACN,CAAC,MAAM;MACHA,UAAU,GAAG,IAAI,CAAC/C,YAAY,CAAC+C,UAAU,CAAC,CAAC;IAC/C;IACA,OAAOA,UAAU;EACrB;EACArC,iBAAiBA,CAAA,EAAG;IAChB,IAAIpB,SAAS,GAAGH,iBAAiB,CAAC,IAAI,CAAC;IACvC,IAAIG,SAAS,GAAG,CAAC,EAAE;MACfA,SAAS,GAAG,IAAI,CAACU,YAAY,CAACV,SAAS,CAAC,CAAC;IAC7C;IACA,IAAI0G,eAAe,GAAG1G,SAAS,GAAG,IAAI,CAACU,YAAY,CAACD,QAAQ,CAAC,CAAC;IAC9D,IAAIgD,UAAU,GAAG,IAAI,CAAC3D,MAAM,CAACC,MAAM,GAAG,IAAI,CAACW,YAAY,CAACD,QAAQ,CAAC,CAAC;IAClE,IAAIkG,aAAa,GAAGjF,IAAI,CAACoD,GAAG,CAAC,CAAC,EAAE,IAAI,CAACpE,YAAY,CAACW,eAAe,CAAC,CAAC,GAAGoC,UAAU,GAAGiD,eAAe,CAAC;IACnG,OAAO;MACHnF,KAAK,EAAEmF,eAAe;MACtBE,GAAG,EAAED;IACT,CAAC;EACL;EACAE,KAAKA,CAAA,EAAG;IACJ,IAAI,CAACpE,mBAAmB,GAAG,CAAC,CAAC;IAC7B,IAAI,CAAC3C,MAAM,GAAG,EAAE;EACpB;AACJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}